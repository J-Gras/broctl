#! /usr/bin/env bash
#
# is-alive <host>

. `dirname $0`/broctl-config.sh

if [ "${os}" == "linux" ]; then
    cmd='ping -q -c 1 -W 1'
    cmd6='ping6 -q -c 1 -W 1'
elif [ "${os}" == "openbsd" -o "${os}" == "netbsd" ]; then
    cmd='ping -q -c 1 -w 1'
    cmd6='ping6 -q -c 1'
else
    cmd='ping -q -t 1 -o'
    cmd6='ping6 -q -o'
fi

if [[ "$1" == *:* ]]; then
    cmd=$cmd6
fi

$cmd $1 >/dev/null 2>&1 || exit 1

ssh -o ConnectTimeout=30 $1 true >/dev/null 2>&1
